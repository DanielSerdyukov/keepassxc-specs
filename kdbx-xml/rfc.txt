



                                                           J. Bevendorff
                                                          KeePassXC Team
                                                       February 19, 2018


                      KeePass2 XML Payload Format
                            keepass2-xml-rfc

Abstract

   This document describes the XML payload format used in KDBX 3.1 and
   4.0 containers.  KDBX is an encrypted, XML-based container format for
   secure password storage used by KeePass 2.x, KeePassXC and various
   other password managers.  This document only describes the actual XML
   payload and not the KDBX container format itself.

Status of This Memo

   This document is not normative for the KDBX file format; it is
   published for informative purposes with the goal to support
   development of KDBX-based password management applications.

   The information contained in this document is a work-in-progress
   reverse engineering effort of the KDBX file format and likely to be
   incomplete or even incorrect at this point in time.  This memo is not
   recommended for use as reference guide yet.

Copyright Notice

   Copyright (C) 2018 KeePassXC Team

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Conventions . . . . . . . . . . . . . . . . . . . . . . . . .   2
     2.1.  General Database Structure  . . . . . . . . . . . . . . .   2
   3.  XML Format Description  . . . . . . . . . . . . . . . . . . .   3
     3.1.  XML Schema  . . . . . . . . . . . . . . . . . . . . . . .   3
       3.1.1.  Basic Data Types  . . . . . . . . . . . . . . . . . .   3
       3.1.2.  Identifiers . . . . . . . . . . . . . . . . . . . . .   4
     3.2.  Main Elements . . . . . . . . . . . . . . . . . . . . . .   4
     3.3.  Meta Data Section . . . . . . . . . . . . . . . . . . . .   5
     3.4.  Data Section  . . . . . . . . . . . . . . . . . . . . . .   7
       3.4.1.  Groups  . . . . . . . . . . . . . . . . . . . . . . .   7
       3.4.2.  Entries . . . . . . . . . . . . . . . . . . . . . . .   7
       3.4.3.  Deleted Objects . . . . . . . . . . . . . . . . . . .   7
   4.  Security Considerations . . . . . . . . . . . . . . . . . . .   7
   5.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   7



Bevendorff               Expires August 23, 2018                [Page 1]

                              KeePass2 XML                 February 2018


     5.1.  Normative References  . . . . . . . . . . . . . . . . . .   7
     5.2.  Informative References  . . . . . . . . . . . . . . . . .   8
   Author's Address  . . . . . . . . . . . . . . . . . . . . . . . .   8

1.  Introduction

   This document describes the payload format used in KDBX (version 3.1
   and 4.0) files.  The payload is encoded as XML ("Extensible Markup
   Language" [XML]).

   KDBX file format versions 3.1 and 4.0 use the same XML structure with
   minor differences in the tags supported.  A note is added where KDBX
   3.1 and 4.0 differ.

   The XML payload itself is mostly self-contained, but may reference
   data from the outer KDBX container.  A note is given where this is
   the case.

2.  Conventions

   In this document, the keywords 'MUST', 'MUST NOT', 'REQUIRED',
   'SHALL', 'SHALL NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'MAY',
   and 'OPTIONAL' in capital letters are used to indicate requirements
   for the format specification.  Their meaning is described in
   [RFC2119].

   The term 'Database' refers to the decrypted XML document payload of a
   KDBX container.

   Conversely, the term 'KDBX' refers to the full container, including
   its encrypted XML payload.

2.1.  General Database Structure

   A database comprises two main parts: a _meta data section_ and the
   actual _data section_.

   The meta data section contains general information about the database
   itself, maintenance information (e.g., when and how to clean up
   deleted entries), access and modification information (e.g., date and
   time of the last database title change), and additional global
   resources (e.g., custom icons).

   The data section contains the actual user data as a tree structure of
   _groups_ and _entries_.

   A _group_ is an element with various attributes containing zero or
   more _entries_.  A group can also contain zero or more sub groups,



Bevendorff               Expires August 23, 2018                [Page 2]

                              KeePass2 XML                 February 2018


   which can again contain groups and entries.  The format of a group is
   described in Section 3.4.1.

   An _entry_ is a set of user credentials and other related data.  An
   entry MUST have a single parent group.  The attributes of an entry
   are described in Section 3.4.2.

   A database MUST have exactly one _root group_, which acts as common
   ancestor of all other groups and entries.

3.  XML Format Description

3.1.  XML Schema

   A full XML 1.0 schema [XMLSchema] is provided in: kdbx4.0-schema.xsd

   The schema file is only intended for informative purposes.  In
   practice, parsers SHALL NOT use this schema for strict validation.
   Most importantly, parsers SHALL NOT make assumptions about the order
   of elements.  "<xs:sequence>" elements are used exclusively for
   Schema 1.0 compatibility, while in reality, no particular element
   order is guaranteed.

   Given the sensitive nature of the data contained in a passwords file,
   a parser SHOULD be reasonably forgiving while trying to read the XML
   data of a successfully decrypted KDBX file.

3.1.1.  Basic Data Types

   All data stored in a KeePass XML file is UTF-8 string data.  Most XML
   elements or attributes can contain arbitrary string values, but some
   elements or attributes require special data types, which impose extra
   restrictions on the allowed string values.

   The following special data types exist:

   o  An _INTEGER_ is a numeric decimal string consisting of one or more
      characters in the range 0 to 9.  _INTEGERs_ can have a negative
      sign "-" in front.

   o  A _BOOLEAN_ is represented by the strings "True" and "False".  The
      alternative forms "true" and "false", as well as "1" and "0", are
      also possible.

   o  A _DATETIME_ is an XML datetime in ISO 8601 format [RFC3339].






Bevendorff               Expires August 23, 2018                [Page 3]

                              KeePass2 XML                 February 2018


   o  A _COLOR_ is a six-digit hexadecimal RGB color code (characters
      0-9 and A-F or a-f), preceded by a # character (e.g., #FF00FF for
      magenta)

   o  A _BLOB_ is a Base64-encoded [RFC4648] string representation of
      arbitrary binary data.

   o  A _STRING MAP_ is a complex XML type with exactly two child
      elements "<Key>" and "<Value>" describing a mapping between a key
      string and a value string.

3.1.2.  Identifiers

   Unique resources inside the database are identified by a _UUID_,
   which is a globally unique 128-bit (16-byte) identifier. _UUIDs_ are
   encoded as _BLOBs_.

3.2.  Main Elements

   A KeePass XML database SHOULD start with an XML declaration.  The
   encoding of the XML data MUST be UTF-8 [RFC3629].

   The XML document MUST have a root element named "<KeePassFile>".  The
   "<KeePassFile>" root element MUST have exactly two child nodes
   "<Meta>" and "<Root>":

          <?xml version="1.0" encoding="utf-8" standalone="yes"?>
          <KeePassFile>
              <Meta>
                  <!-- Database meta data -->
              </Meta>
              <Root>
                  <!-- Database root group -->
                  <!-- Optional deleted object records -->
              </Root>
          </KeePassFile>

   "<Meta>" contains the database's meta data section, while "<Root>"
   contains the actual data section, i.e., the root group (see
   Section 2.1).

   Besides the database's root group, "<Root>" MAY also contain
   historical records of deleted objects, whose format is described in
   Section 3.4.3.







Bevendorff               Expires August 23, 2018                [Page 4]

                              KeePass2 XML                 February 2018


3.3.  Meta Data Section

   The "<Meta>" element MAY contain any of the following elements at
   most once to describe various database meta data.

   <HeaderHash>  The SHA-256 [RFC4634] hash of the KDBX header data as
      _BLOB_.  This element is only useful for KDBX 3.1 or lower, but
      MAY also be present in KDBX 4.0 or higher.

   <SettingsChanged>  _DATETIME_ of the last change of database meta
      data or KDBX container settings.  This element is only specified
      for KDBX containers *version 4.0 or higher* and MUST NOT be
      present in KDBX 3.1 or lower.

   <Generator>  The name of the program that generated the KDBX file.

   <DatabaseName>  An optional name for the database.

   <DatabaseNameChanged>  _DATETIME_ of the last change of
      "<DatabaseName>".

   <DatabaseDescription>  An optional description of the database.

   <DatabaseDescriptionChanged>  _DATETIME_ of the last change of
      "<DatabaseDescription>".

   <DefaultUserName>  The username to use as a default when creating a
      new entry in the database.

   <DefaultUserNameChanged>  _DATETIME_ of the last change of
      "<DefaultUserName>".

   <MaintenanceHistoryDays>  _INTEGER_ indicating the maximum age of the
      oldest history item to keep in days.

   <Color>  A _COLOR_ that can be used for coloring the program icon or
      database tab inside the password manager application.

   <MasterKeyChanged>  _DATETIME_ of the last change of the database's
      master key.

   <MasterKeyChangeRec>  _INTEGER_ indicating the number of days after
      which the password manager SHOULD recommend changing the
      database's master key (-1 means 'never')

   <MasterKeyChangeForce>  _INTEGER_ indicating the number of days after
      which the password manager SHOULD force changing the database's
      master key (-1 means 'never')



Bevendorff               Expires August 23, 2018                [Page 5]

                              KeePass2 XML                 February 2018


   <MasterKeyChangeForceOnce>  _BOOLEAN_ indicating that the password
      manager SHOULD force changing the database's master key next time
      the database is opened.  This element SHOULD be removed or set to
      'False' once the master key has been changed.

   <MemoryProtection>  A complex XML type for configuring which fields
      SHOULD be protected by in-memory encryption at runtime.  The
      element MAY have the _BOOLEAN_ child elements "<ProtectTitle>",
      "<ProtectUserName>", "<ProtectPassword>", "<ProtectURL>", and
      "<ProtectNotes>" for protection of the title, username, password,
      URL and notes fields.

   <CustomIcons>  A complex XML type containing a sequence of zero or
      more custom icons, which can be used for visually customizing
      groups and entries (described in Section 3.4.1 and Section 3.4.2).
      An icon is an "<Icon>" element, which has exactly two children
      "<UUID>" (a _UUID_) and "<Data>".  "<Data>" contains the icon
      image data as _BLOB_.

   <RecycleBinEnabled>  _BOOLEAN_ indicating whether the database has an
      enable recycle bin.

   <RecycleBinUUID>  The _UUID_ of the recycle bin group inside the
      database.

   <RecycleBinChanged>  _DATETIME_ of the last change to the recycle
      bin.

   <EntryTemplatesGroup>  The _UUID_ of the group that contains
      templates for the creation of new entries.

   <EntryTemplatesGroupChanged>  _DATETIME_ of the last change to the
      templates group.

   <HistoryMaxItems>  An _INTEGER_ indicating the maximum number of
      items the history of an element may have (history items are
      described in Section 3.4.2.1).  When the number of items in an
      entry's history exceeds this number, the password manager SHOULD
      delete the oldest history items until the number of history items
      no longer exceeds this value.

   <HistoryMaxSize>  An _INTEGER_ indicating the maximum history size in
      bytes.  If an entry's history exceeds this size, the password
      manager SHOULD delete the oldest history items, until the total
      history size no longer exceeds this value.

   <LastSelectedGroup>  _UUID_ of the group that was last selected by
      the user.



Bevendorff               Expires August 23, 2018                [Page 6]

                              KeePass2 XML                 February 2018


   <LastTopVisibleGroup>  _UUID_ of the last 'top' item.  This seems to
      always be the root group of the database.

   <Binaries>  A sequence of zero or more "<Binary>" elements containing
      files attached to entries in the database.  Each "<Binary>"
      element is a _BLOB_ containing the file's contents. "<Binary>"
      elements MUST have an "ID" attribute, which is a unique _INTEGER_
      identifying the _BLOB_ data and a _BOOLEAN_ attribute
      "Compressed", indicating whether the _BLOB_ data is Gzip-
      compressed [RFC1952].  A database SHOULD NOT contain two
      "<Binary>" elements with the same _BLOB_ data.

   <CustomData>  A sequence of zero or more _STRING MAP_ "<Item>"
      elements. "<Item>" elements can be used by plugins to store
      arbitrary string data at database level.

3.4.  Data Section

3.4.1.  Groups

3.4.2.  Entries

3.4.2.1.  Entry History

3.4.3.  Deleted Objects

4.  Security Considerations

   KDBX is an encrypted container format.  The security of the XML
   payload described in this document depends on the strength of the
   cipher and passphrase / key file used for encrypting the
   encapsulating KDBX container.

   In addition, all security considerations for [XML] apply as well,
   including the use of recursive XML entities, which can consume an
   arbitrarily large amount of memory on the user's system during
   parsing.

5.  References

5.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997, <https://www.rfc-
              editor.org/info/rfc2119>.





Bevendorff               Expires August 23, 2018                [Page 7]

                              KeePass2 XML                 February 2018


   [RFC3339]  Klyne, G. and C. Newman, "Date and Time on the Internet:
              Timestamps", RFC 3339, DOI 10.17487/RFC3339, July 2002,
              <https://www.rfc-editor.org/info/rfc3339>.

   [RFC3629]  Yergeau, F., "UTF-8, a transformation format of ISO
              10646", STD 63, RFC 3629, DOI 10.17487/RFC3629, November
              2003, <https://www.rfc-editor.org/info/rfc3629>.

   [RFC4648]  Josefsson, S., "The Base16, Base32, and Base64 Data
              Encodings", RFC 4648, DOI 10.17487/RFC4648, October 2006,
              <https://www.rfc-editor.org/info/rfc4648>.

   [XML]      Bray, T., Paoli, J., Sperberg-McQueen, C., Eve, E., and F.
              Yergeau, "Extensible Markup Language (XML) 1.0 (Fifth
              Edition)", November 2008, <https://www.w3.org/TR/2008/REC-
              xml-20081126/>.

   [XMLSchema]
              Thompson, H., Beech, D., Maloney, M., and N. Mendelsohn,
              "XML Schema Part 1: Structures Second Edition", October
              2004, <https://www.w3.org/TR/xmlschema-1/>.

5.2.  Informative References

   [RFC1952]  Deutsch, P., "GZIP file format specification version 4.3",
              RFC 1952, DOI 10.17487/RFC1952, May 1996,
              <https://www.rfc-editor.org/info/rfc1952>.

   [RFC4634]  Eastlake 3rd, D. and T. Hansen, "US Secure Hash Algorithms
              (SHA and HMAC-SHA)", RFC 4634, DOI 10.17487/RFC4634, July
              2006, <https://www.rfc-editor.org/info/rfc4634>.

Author's Address

   Janek Bevendorff
   KeePassXC Team















Bevendorff               Expires August 23, 2018                [Page 8]
